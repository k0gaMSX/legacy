▼▽▼▽▼▽▼▽▼▽▼▽▼▽▼▽▼▽▼▽▼▽▼▽▼▽▼▽▼▽▼▽▼▽▼▽▼▽▼

  Text-editor							APeD.COM

	ＡＰｅＤ ver0.41

		動作機種：MSX2+/turboR （一部の MSX2 でも動作可）
		動作環境：MSX-DOS2
				* MMS(Memory-Mapper) : 0-255seg (1seg/128行)
				* 第1・第2水準漢字ROM
				+ MSX-JE
				+ A1GT内蔵 View-font

	copyright (c)1997-1998		KAKAMI_Hiroyuki		各務 裕之

▲△▲△▲△▲△▲△▲△▲△▲△▲△▲△▲△▲△▲△▲△▲△▲△▲△▲△▲△▲


■【概要】

　MSX2+> MSX-DOS2用のテキストエディタです。
　ANK / MS-Kanji コード（記号のみ JIS X 0208:1983 に準拠）の表示および入
力に対応しています。漢字入力には MSX-JE が必要です。

　対象テキストの行数に応じた分の MMS (1seg/128行) が必要です。
　画面上の１行につき、強制的に 128byte を消費します。



■【使用方法】

　MSX-DOS2 上で使用します。usage は次のようになります。

	:> APeD  ＜入力ファイル＞  ［オプション］


《入力ファイル》
	任意のテキストファイルを、ドライブ・パス・ファイルで指定します。
	ワイルドカードは指定できません。
	存在しないファイルを指定した場合、新規ファイルの作成になります。


《オプション》
	オプションは大文字でも小文字でも構いません。
	１つのオプションの前には、必ず１つの "/" を付けてください。

  /H	 : Help
	ヘルプを表示します。
	入力ファイル無指定時にも、自動的にヘルプを表示します。

  /A	 : ANK
	全ての文字を 1byte-code で表示します。
	ただし、編集は MS-kanji コード毎でしか行えません。

  /J[n]  : Line-Jump
	ファイル読込み後、指定行（0〜65535）に移動します。
	省略時はテキスト先頭（第0行）になります。
	指定行が全行数より多い場合には、テキスト末尾に移動します。

  /E[n]  : EOF-mode
	ファイル読込み時に EOF($1A) 以降を読込むか、また
	保存時、テキスト末尾に EOF($1A) を付加するかどうかを選択します。
		・0 : EOF 以降を読込む   ／ EOF を付加しない
		・1 : EOF 以降を無視する ／ EOF を付加する	 (default)
	パラメータ省略時は、0←→1 のトグルスイッチになります。

  /T<n>  : Tab-column
	tab($09) のカラム数を 1,2,4,8 のいずれかから指定します。
	初期状態は 8 です。

  /V<n>	 : View-mode
	表示方式を 0〜3 の範囲で変更します。
		・bit0 : 0 = Non-interlace
			 1 = Interlace
		・bit1 : 0 = 漢字ROM-font
			 1 = A1GT内蔵 View-font （A1GT以外では不可）
	初期状態は 1 (Interlace, 漢字ROM-font) です。

  /I[n]  : Indicator-mode
	画面最下行にインジケータを表示するかどうかを選択します。
		・0 : MSX-JE 起動時のみ簡略表示
		・1 : 常に表示					(default)
	パラメータ省略時は、0←→1 のトグルスイッチになります。

  /CF<rgb> : Color-foreground
  /CB<rgb> : Color-background
	文字色・背景色を変更します。
	0〜7 を RGB の順に３桁で指定します。（例 : "/CF777","/CB002"）



■【操作方法】

　ASCII製スクリーンエディタ「KID/AKID」にほぼ準拠しています。
　現在、下記操作に対応しています。

	・Cursor		 [↑][↓][←][→] [^E][^X][^S][^D] [^A][^F]
	・Side			 [shift]+[←][→] [^B]
	・Roll-up/down		 [shift]+[↑][↓] [^W][^Z]
	・Page-up/down		 [^C][^R]
	・Jump-top/bottom	 [^O][^P]
	・Delete		 [DEL] [^G]
	・Back-space		 [BS]  [^H]
	・Insert		 [INS] [^J]
	・Tiny-Cut		 [^Y][^U][^K]
	・Tiny-Paste		 [^L]
	・Yank-Copy/Cut		 [F5]
	・Yank-Paste		 [^@]
	・Return		 [RET] [^M]
	・Insert-Null		 [^N]
	・Tab			 [TAB] [^I]
	・Input-Ctrl-char	 [^V]
	・Info			 [^Q]
	・Function-key		 [F1]-E/Q/S/O
				 [F2]-I
				 [F3]-G/T/B
	・JE-on/off		 [CTRL]+[SPC]



■【カスタマイズ】

　Tatsu氏作「Ayaka」ver1.04 によりカスタマイズ出来ます。
（但し、xmark (X.COM), Sayaka (SAYAKA.COM) には非対応です）
　予め、同梱された「APED_INI.CFG」ファイルを「APED.CFG」に変更して下さい。

　書式は以下の通りです。

	:> Ayaka2 APED.COM APED.CFG /K

　第２パラメータの「APED.CFG」は省略可能です。
　「/K」オプションを付けると、タイムスタンプを変更しません。
　詳しくは Ayaka のドキュメントファイルを御覧下さい。



■【注意】

　対象テキストの（画面上の）行数に応じた分の MMS が必要です。
　具体的には、 (MMS 数 + 1) * 128 行まで扱えます。

	   MMS (seg)  :    0     1     4    16    64   256
	Memory (Byte) :    0   16K   64K  256K    1M    4M
	              |
	  行数 (line) :  128   256   640  2176  8320 32896


　画面表示は GRP5(sc6) にて行っています。
　表示方式が Interlace モード（/V1,3）の場合は、VSYNC 割込み時にパレット
切替を行うことで疑似インターレース表示を行っています。その為、割込みが禁
止されている間は表示が乱れます。
　View-font モード（/V2,3）は、機種が A1GT の場合のみ有効です。機種の確
認は行っていない為、それ以外の機種で指定すると暴走する危険があります。
　現在のところ、外付け MSX-View カートリッジに対応する予定はありません。


　操作方法について、KID/AKID とは以下の相違があります。

	・Block-Delete [^U][^K] に於いて、KID/AKID では論理行の末端まで
	　削除されるが、APeD では画面上の左端／右端までしか削除されない。
	　（APeD の仕様です。変更する予定はありません）


　その他、以下の不具合が分かっています。

	・ファンクションキーのメニューの内、いくつかは未だ実行できない。
	・[INS] で上書きモードにしても、JE 入力時には上書きされない。
	・2byteコードが混じった行では、折返しが正常に行われない場合がある。

など。



■【エラー】

《起動時》

・Invaid MSX-machine.
　　MSX2以前の機種で起動したときに表示されます。

・Not MSX-DOS2.
　　MSX-DOS2 以外（CP/M, MSX-DOS1）で起動したときに表示されます。

・Not enough Memory.
　　TPA サイズが不足しています。
　　必要な TPA は、MSX-JE が使用するワークエリアのサイズに依存します。

・Bad option.
　　オプションに不正があります。

・Too many Parameters.
　　パラメータの数が多すぎます。

・Illegal Customize.
　　カスタマイズされた内容に異常があります。


《編集中》

・Too many Lines.
　　総行数が最大数に達しました。（最大行数は空きMMS数に依存します）

・Yank buffer full.
　　Yank バッファが溢れました。（最大サイズは64KB弱です）



■【参考】

・アスキー
	MSX-DOS2用スクリーンエディタ「KID/AKID」

・宇佐美 仁識  (Viper)
	MSX-DOS用テキストエディタ「viper&zero」

・日本経済新聞社
	「直感！ワープロ漢字辞典 増補改訂版」			    (￥1,942)

・ASCAT
	「ＭＳＸテクニカルガイドブック 第四版」

・Tatsuhiko Syoji  (Tatsu)
	「汎用カスタマイザ Ayaka Ver 1.04」 document

・なむ
	「ViewFontの読み出し方」

・Ａ ｔｏ Ｃ
	「Let's use 『MSX-View付属ROM』 第二版」



■【使用および配布について】

　このソフトウェアは Free-Software です。著作権は作者が保持しています。
営利・非営利を問わず、誰でも無料で使用することができます。

　転載・配布は自由です。確認及び連絡なども、特に必要としません。
　各自に於いて改良・改造したものは、その旨（原作者名，改造者名，改造箇所）
を明記した上で、配布は自由とします。

　このソフトウェアを使用した結果の影響については一切の責任を負いかねます
ので、あらかじめご了承ください。



■【奥付】

　構想から早や３年弱、ようやく「エディタ」らしき形になりました。
　メモリ効率が悪い為、ＭＭＳを多量に消費します。ご了承下さい。


　ver0.20 でキー・コンフィグを追加しました。
　初期設定は KID (Mifes) ライクになっています。因みに [Prefix.4] が V&Z 
ライクに設定してますので、参考までに。（初期状態では [HOME]-[?] で入力さ
れます。例えば、[HOME]-[T] で「行の二重化」など）

　ver0.22 で、A1GT内蔵 View-font に対応しましたが、外付け MSX-View カー
トリッジには未対応です。今後の対応は要望次第で考えます。
　取り合えず、てんじくてんじく、なむさん＆ＡｔｏＣさん有り難う。


　ver0.30 にて Yank-Copy/Paste が付きました。
　まだ表示が未完成の為、選択行が画面上に反映されませんのでご注意下さい。
因みに、Yank バッファの容量は 64KB 弱です（VRAM $10000〜$1FFFF を使用）。

　操作方法を説明しますと、まず [F5] を押して先頭行（終端行）を決定します。
　その後カーソルを終端行（先頭行）まで移動させて [C][A][X][M] を押せば、
それぞれ複写・追加複写・削除・追加削除を実行します。ペーストは [^@]です。
　[F5],[ESC] キーを押した場合はキャンセルします。


　また、[^Q] (029 : Put-info) で、現在使用出来る行数を
	" <ファイル> - <論理行番号> [<物理行番号>:<物理行数>/<最大物理行数>] "
という型式で表示します。
　ただファイル名をフルパスで表示している為、あまりにディレクトリが深いと
右端が正常に表示されません。"ドライブ名:ファイル名" だけに変更しようか。


　ver0.31 にて、[SHIFT],[CTRL]+[制御キー] の入力に対応し、伴って CFG 
ファイルの Key-map の記述方法も以下の様に変更しました。

	;	NORM SHFT CTRL ----
	db	 7Fh,0FFh,0FFh, 00h		; ESC
	db	 06h,0FFh,0FFh, 00h		; TAB
	db	 00h, 00h, 00h, 00h		; ---,---,CTRL+STOP,---
	db	 05h,0FFh, 05h, 00h		; BS
	db	 60h,0FFh,0FFh, 00h		; SEL
	db	 03h,0FFh,0FFh, 00h		; CR
	db	 01h, 01h, 4Bh, 00h		; SPC
	db	 6Bh, 68h,0FFh, 00h		; HOME,CLS,---,---
	db	 07h,0FFh,0FFh, 00h		; INS
	db	 04h,0FFh, 04h, 00h		; DEL
	db	 0Ah, 0Eh, 0Ah, 00h		; csL
	db	 08h, 0Ch, 08h, 00h		; csU
	db	 09h, 0Dh, 09h, 00h		; csD
	db	 0Bh, 0Fh, 0Bh, 00h		; csR

　左から、通常入力・[SHIFT]+[?]・[CTRL]+[?]・[SHIFT]+[CTRL]+[?] です。
　但し MSX の仕様上、同時に３個以上のキーを押すと正常に判定されない場合
があるので、[SHIFT]+[CTRL]+[?] は 00h (無処理) にしておくのが無難です。
　あと、内部構造上 [STOP]・[SHIFT]+[STOP] の入力は検出できません。

　この範囲内だけ、機能番号 $FF でその左側に指定した機能番号が有効になり
ます。例えば [CTRL]+[CR] を押すと、その左の [SHIFT]+[CR] が参照され、これ
も $FF なので結局 [CR] と同じになります。
　一番左側に $FF を指定した場合、動作保証は出来ません。

　[CTRL]+[BS]/[DEL] にそれぞれ $20(Del-before), $21(Del-after) を指定すれ
ば、V&Z ライクな使い方が出来ます。ただ、どこかのキーに $23(Undel) を設定
しておかないと、不用意に消した場合に戻せなくなるのでご注意を。


　ver0.32 にて、EOF-mode = 0 の場合には EOF 以降も読込みを行うよう変更し
ました。これで MAG のヘッダを書き換えたりも出来るｶﾅ。

　あと、ようやく上書き入力モードに暫定対応しました。ただし、JE入力時には
上書き／挿入モードに関わらず挿入されます。ﾋｰ
　内部的には、画面表示を見ても分かる通り、一旦削除したあと挿入するという
安直なコーディングになっています。しばらくはこれで我慢して下さい。


　ver0.40 にて、内部構造にかなりの変更を行いました。一通り動作チェックは
しましたが、エンバグしているかも知れませんのでご注意下さい。

　今までは都合上、最終行に強制的に改行コードが付加されていたのですが、こ
の仕様を撤廃しました。とあっさり言う割には、かなり対応が面倒でした。
　とりあえず、移動・編集に齟齬が出ないように ad hoc に仕上げてあります。

　また、機能番号 $76〜$7F の割当てを変更しました。まだ機能が実装されてい
ない番号が殆どですが、デフォルトの CFG ファイルでは Prefix.1 にいくつか
が予め設定されています。旧番号-新番号の対応は、APED.HIS を参照下さい。

　加えて、操作のキャンセルを、[ESC] キー固定から機能番号 $7F に変更しま
した。これにより、任意のキーで Yank-Copy/Cut 等のキャンセルを行えるよう
になりました。初期状態では、[ESC] と [CTRL]+[STOP] に設定してあります。

　さて今回の目玉ですが、１行入力端末に暫定対応しました。但し、端末内での
JE入力は未だ不可能です（というより、ANK 入力と BS しか使えません）。
　現在のところ１行入力端末を使用している機能は、以下の２つです。
	・$1C=028 : Line-Jump		[F3]G	| ^QJ
	・$78=120 : File-Insert		[F2]I	| [ESC]I
ってつまり、行ジャンプとファイル挿入に対応したってことですね。


　ver0.40 をアップロードしようとネコネにアクセスした時、めらまん氏から
「JE変換バッファが空でない時に、カーソルを変換バッファ先頭へ移動して 
[RET] を押すと暴走する」という報告があると知りました。ver0.40 でも同様の
バグが再現された為、急遽バグフィックス版 ver0.41 に差し替えます。
　JEから受け取る変換結果文字列のサイズが 0 である時を考慮していなかった
のが原因でした。（要するに bc=0 にて ldir を使っていた）

　私事ですが、予想より早く３月中旬から会社勤めとなり、なかなか開発時間が
取れなくなってしまいました。暇を見ては version-up を進めていきたいです。

　それにしてもまだ、検索・置換・ファイル書出……等々が実装されてない哉。


			〒500-8367(旧500) 岐阜市宇佐南１-２-５
							各務 裕之 （ＡＰｉ）

	東京	NetComplex Net				NAT26323
	東京	MARIO-NET				API
	愛知	PP-NET					PP-00035
	大阪	Illusion City (現在休止中)		API
	大阪	SAKA-NET				SAK00012
	岐阜	あしながねっと				API
	石川	ネットフレンティ金沢			NWC03867

	E-mail	:   l0461622@ice.nuie.nagoya-u.ac.jp		(1998年3月迄)
	URL	: http://www.ice.nuie.nagoya-u.ac.jp/~l0461622/	(    〃     )

[eof]
